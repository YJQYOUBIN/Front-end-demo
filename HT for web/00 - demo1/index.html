<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <script src="../ht-for-web-7.0.8/lib/core/ht.js"></script>
    <script src="./js/BusEdgeType.js"></script>
    <script>
        ht.Default.setImage('workgroup', 'images/workgroup.png');
        ht.Default.setImage('rect', {
            width: 80,
            height: 50,
            comps: [
                {
                    type: 'rect',
                    rect: [ 2, 2, 76, 46 ],
                    borderWidth: 2,
                    borderColor: '#3498DB',
                    background: '#aaaaaa'
                }
            ]
        });
        var init = function() {
            var g2d = new ht.graph.GraphView();
            g2d.addToDOM();

            var dm = g2d.dm();
            bus = new ht.Shape();
            bus.setPoints([
                { x: 0, y: 0 },
                { x: 0, y: 50 },

                { x: 0, y: 25 },
                { x: 700, y: 25 },
                { x: 700, y: 230 },
                { x: 0, y: 230 },

                { x: 0, y: 205 },
                { x: 0, y: 255 }
            ]);
            bus.s({
                'shape.background': null,
                'shape.border.width': 10,
                'shape.border.color': 'black',
                'shape.border.cap': 'butt',
                'shape.border.join': 'miter'
            });
            dm.add(bus);

            var startX = 70, disX = 50, disY = 35,
                startY = 60, i = 0, node;

            while (i < 2) {
                node = new ht.Node();
                node.s({
                    'label': (i + 1) + 'T',
                    'label.font': '16px arial'
                });
                node.setImage('rect');
                node.setWidth(40);
                node.setHeight(25);
                node.setPosition({ x: -70, y: (i++ % 2) ? 25 : 230 });
                node.setHost(bus);
                dm.add(node);

                var edge = new ht.Edge(bus, node);
                edge.s('edge.type', 'bus');
                dm.add(edge);
            }

            var serverIndex = 1;
            i = 1;
            while (startX < 600) {
                createNode(dm, { x: startX, y: (i++ % 2) ? -40 : 90 }, bus, serverIndex++);
                startX += disX;
            }

            i = 0;
            while (startY < 225) {
                createNode(dm, { x: (i++ % 2) ? 635 : 765, y: startY }, bus, serverIndex++);
                startY += disY;
            }

            startX = 70;
            i = 0;
            while (startX < 600) {
                createNode(dm, { x: startX, y: (i++ % 2) ? 165 : 295 }, bus, serverIndex++);
                startX += disX;
            }

            bus.setPosition({ x: 600, y: 300 });
        };

        var createNode = function(dm, position, source, name) {
            var node = new ht.Node();
            node.s({
                'label': name,
                'label.font': '16px arial'
            });
            node.setImage('workgroup');
            node.setPosition(position);
            node.setHost(source);
            dm.add(node);

            var edge = new ht.Edge(source, node);
            edge.s('edge.type', 'bus');
            dm.add(edge);

            return node;
        };
    </script>
</head>
<body onload="init();">

</body>
</html>
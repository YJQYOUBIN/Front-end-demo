!function(B,s){"use strict";var E=ht.AlarmSeverity=function(Z,L,K,V,e){this.value=Z,this.name=L,this.nickName=K,this.color=V,this.displayName=e};ht.Default.def("ht.AlarmSeverity",s,{toString:function(){return this.displayName||this.name}}),function(){E.severities=new ht.List,E._vm={},E._nm={},E._cp=function(T,w){if(T&&w){var H=T.value-w.value;return H>0?1:0>H?-1:0}return T&&!w?1:!T&&w?-1:0},E.each=function(e,Z){E.severities.each(e,Z)},E.getSortFunction=function(){return E._cp},E.setSortFunction=function(j){E._cp=j,E.severities.sort(j)},E.add=function(v,R,B,p,z){var $=new E(v,R,B,p,z);return E._vm[v]=$,E._nm[R]=$,E.severities.add($),E.severities.sort(E._cp),$},E.remove=function(d){var R=E._nm[d];return R&&(delete E._nm[d],delete E._vm[R.value],E.severities.remove(R)),R},E.CRITICAL=E.add(500,"Critical","C","#FF0000"),E.MAJOR=E.add(400,"Major","M","#FFA000"),E.MINOR=E.add(300,"Minor","m","#FFFF00"),E.WARNING=E.add(200,"Warning","W","#00FFFF"),E.INDETERMINATE=E.add(100,"Indeterminate","N","#C800FF"),E.CLEARED=E.add(0,"Cleared","R","#00FF00"),E.isClearedAlarmSeverity=function(W){return W?0===W.value:!1},E.getByName=function(s){return E._nm[s]},E.getByValue=function(o){return E._vm[o]},E.clear=function(){E.severities.clear(),E._vm={},E._nm={}},E.compare=function(M,p){return E._cp(M,p)}}();var i=ht.AlarmState=function(A){this._d=A,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",s,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var I=null;for(var m in this._am)m=E.getByName(m),E.isClearedAlarmSeverity(m)||0!==this.getAcknowledgedAlarmCount(m)&&(I=I?E.compare(I,m)>0?I:m:m);this._haa=I},_c2:function(){var u=null;for(var i in this._nm)i=E.getByName(i),E.isClearedAlarmSeverity(i)||0!==this.getNewAlarmCount(i)&&(u=u?E.compare(u,i)>0?u:i:i);this._hna=u},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var e in this._nm)if(e=E.getByName(e),!E.isClearedAlarmSeverity(e)&&0!==this.getNewAlarmCount(e)&&E.compare(this._hna,e)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var P=this._haa,h=this._hna,g=this._ps;this._hoa=P,E.compare(h,this._hoa)>0&&(this._hoa=h),E.compare(g,this._hoa)>0&&(this._hoa=g)},_c5:function(){var _=this._haa,S=this._hna;this._hta=_,E.compare(S,this._hta)>0&&(this._hta=S)},increaseAcknowledgedAlarm:function(N,t){if(0!==t){t=t||1;var q=this._am[N.name]||0;q+=t,this._am[N.name]=q,this._f()}},increaseNewAlarm:function(K,E){if(0!==E){E=E||1;var T=this._nm[K.name]||0;T+=E,this._nm[K.name]=T,this._f()}},decreaseAcknowledgedAlarm:function(y,u){if(0!==u){u||(u=1);var R=this._am[y.name]||0;if(R-=u,0>R)throw"Alarm count can not be negative";this._am[y.name]=R,this._f()}},decreaseNewAlarm:function(V,z){if(0!==z){z||(z=1);var d=this._nm[V.name]||0;if(d-=z,0>d)throw"Alarm count can not be negative";this._nm[V.name]=d,this._f()}},acknowledgeAlarm:function(q){this.decreaseNewAlarm(q,1),this.increaseAcknowledgedAlarm(q,1)},acknowledgeAllAlarms:function(V){if(V){var i=this.getNewAlarmCount(V);this.decreaseNewAlarm(V,i),this.increaseAcknowledgedAlarm(V,i)}else for(var w in this._nm)this.acknowledgeAllAlarms(E.getByName(w))},_c6:function(){this._aac=0;for(var a in this._am)a=E.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(d){return d?this._am[d.name]||0:this._aac},getAlarmCount:function(o){return this.getAcknowledgedAlarmCount(o)+this.getNewAlarmCount(o)},_c7:function(){this._nac=0;for(var i in this._nm)this._nac+=this.getNewAlarmCount(E.getByName(i))},getNewAlarmCount:function(c){return c?this._nm[c.name]||0:this._nac},setNewAlarmCount:function(X,k){this._nm[X.name]=k,this._f()},removeAllNewAlarms:function(V){V?delete this._nm[V]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(E,Y){this._am[E.name]=Y,this._f()},removeAllAcknowledgedAlarms:function(w){w?delete this._am[w.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(Z){if(this._ep||(Z=null),this._ps!==Z){var e=this._ps;this._ps=Z,this._f(),this._d.fp("propagateSeverity",e,Z)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(V){var M=this._ep;this._ep=V,this._d.fp("enablePropagation",M,V)&&(V||this.setPropagateSeverity(null))}});var S=ht.AlarmStatePropagator=function(i){this._dataModel=i,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",s,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(H){this._enable!==H&&(this._enable=H,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(f){this.propagate(f)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(y){y.data&&this.propagate(y.data)},handleDataPropertyChange:function(k){if("alarmState"===k.property||"enablePropagation"===k.property)this.propagate(k.data);else if("parent"===k.property){var W=k.oldValue;W&&this.propagate(W),this.propagate(k.data)}},propagate:function(l){l&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(l),this._isPropagating=!1)},propagateToTop:function(A){for(this.propagateToParent(null,A);A&&A.getParent();)this.propagateToParent(A,A.getParent()),A=A.getParent()},propagateToParent:function(n,N){var Q=null;N.getChildren().each(function(r){var $=r.getAlarmState().getHighestOverallAlarmSeverity();E.compare($,Q)>0&&(Q=$)}),N.getAlarmState().setPropagateSeverity(Q)}}),ht.AlarmStateStatistics=function(h){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(h)},ht.Default.def("ht.AlarmStateStatistics",s,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(L){var r=this._dataModel;r!==L&&(r&&(r.umd(this.handleDataPropertyChange,this),r.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=L,this.reset(),L.md(this.handleDataPropertyChange,this),L.mm(this.handleDataModelChange,this),this.fp("dataModel",r,L))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function($){"alarmState"===$.property&&(this.increase($.data),this.fireAlarmStateChange())},handleDataModelChange:function(S){"add"===S.kind?(this.increase(S.data),this.fireAlarmStateChange()):"remove"===S.kind?(this.decrease(S.data),this.fireAlarmStateChange()):"clear"===S.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,E.each(function(d){var _=this.getSumInfo(d);this.sumAcked+=_.ackedCount,this.sumNew+=_.newCount,this.sumTotal+=_.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(_){if(!_)return this.sumNew;var J=this.getSumInfo(_);return J.newCount},getAcknowledgedAlarmCount:function(k){if(!k)return this.sumAcked;var $=this.getSumInfo(k);return $.ackedCount},getTotalAlarmCount:function(O){if(!O)return this.sumTotal;var A=this.getSumInfo(O);return A.totalCount},getSumInfo:function(a){var N=this.severtiyMap[a.name];return N||(N={},N.newCount=0,N.ackedCount=0,N.totalCount=0,this.severtiyMap[a.name]=N),N},decrease:function(A){var H=this.dataMap[A.getId()];H&&(delete this.dataMap[A.getId()],E.each(function(L){var T=H[L.name],Q=this.getSumInfo(L);Q.newCount=Q.newCount-T.newCount,Q.ackedCount=Q.ackedCount-T.ackedCount,Q.totalCount=Q.totalCount-T.totalCount},this))},increase:function(J){if(this.decrease(J),!this._filterFunc||this._filterFunc(J)){var q={},H=J.getAlarmState();this.dataMap[J.getId()]=q,E.each(function(b){var K={};K.newCount=H.getNewAlarmCount(b),K.ackedCount=H.getAcknowledgedAlarmCount(b),K.totalCount=H.getAlarmCount(b),q[b.name]=K;var E=this.getSumInfo(b);E.newCount=E.newCount+K.newCount,E.ackedCount=E.ackedCount+K.ackedCount,E.totalCount=E.totalCount+K.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(G){var c=this._filterFunc;this._filterFunc=G,this.reset(),this.fp("filterFunc",c,G)},getFilterFunc:function(){return this._filterFunc}});var r=ht.Data.prototype;r.getAlarmState=function(){return this._alarmState||(this._alarmState=new i(this))},r=ht.DataModel.prototype,r.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},r.setEnableAlarmStatePropagator=function(u){u!=this.isEnableAlarmStatePropagator()&&(u?(this._alarmStatePropagator=new S(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},r=ht.graph.GraphView.prototype,r.getNote2=function(J){var V=J.getAlarmState().getHighestNewAlarmSeverity();if(V){var E=J.getAlarmState().getNewAlarmCount(V)+V.nickName;return J.getAlarmState().hasLessSevereNewAlarms()&&(E+="+"),E}return J.s("note2")},r.getNote2Background=function(l){var Y=l.getAlarmState().getHighestNewAlarmSeverity();return Y?Y.color:l.s("note2.background")},r.getBodyColor=function(O){var d=O.getAlarmState().getHighestNativeAlarmSeverity();return d?d.color:O.s("body.color")},r.getBorderColor=function(r){var u=r.getAlarmState().getPropagateSeverity();return u?u.color:r.s("border.color")},r=ht.widget.TreeView.prototype,r.getBorderColor=function(F){var I=F.getAlarmState().getPropagateSeverity();return I?I.color:F.s("border.color")},r.getIcon=function(q){return q.getIcon()?"__alarmIcon__":null},r=ht.widget.TreeTableView.prototype,r.getBorderColor=function(N){var d=N.getAlarmState().getPropagateSeverity();return d?d.color:N.s("border.color")},r.getIcon=function(G){return G.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(h){return h.getIcon()}},color:{func:function(B){var P=B.getAlarmState().getHighestNativeAlarmSeverity();return P?P.color:B.s("body.color")}},rect:[0,0,16,16]}]});var K=ht.Style;K["note2.expanded"]=!0,K["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
!function(q){"use strict";var o=q.ht,J=o.Default,M=J.getInternal(),m=M.ui(),n=null,P="__segmentLengths",t="__lineTotalLength",f="__linePoints",K="__distance0",W="flow.count",l="flow.step",e="flow.element.max",k="flow.element.count",V="flow.element.min",D="flow.element.space",d="flow.element.autorotate",z="flow.element.background",B="flow.element.shadow.max",r="flow.element.shadow.min",w="flow.element.shadow.begincolor",s="flow.element.shadow.endcolor",Q="flow.element.shadow.visible",Y="flow.element.image",L="flow",S=o.Math.Vector2,X=new S;new S,new S,o.List;var G=o.Default._edgeProtectMethod,T=G.getStraightLinePoints,C=function(H,Q){for(var w=[],t=H.length,v=0;t>v;v++){var S=H[v];S._as&&(S=S._as);for(var b=S[0],$=1;$<S.length;$++)w.push([b,S[$]]),b=S[$]}for(var n=[],v=0;v<w.length;v++){var A=F(w[v][0],w[v][1],Q);n.push(A)}return{distance:n,segments:w}},h=function(m,I,K){if(m){for(var g,Q=C(m,I),o=Q.distance,B=Q.segments,O=1/0,Z=null,s=0,v=o.length;v>s;s++){var k=o[s];k.z<O&&(g=s,O=k.z,Z=k)}if(null==K&&(K=.1),Z.z<K){for(var H=0,c=0;g>=c;c++)H+=J.getDistance(B[c][0],g>c?B[c][1]:Z);return H}}},F=function(K,F,B){var a=K.x,t=K.y,d=F.x,e=F.y,O=B.x,x=B.y,m=d-a,s=e-t,Y=Math.sqrt(m*m+s*s),P=m/Y,u=s/Y,J=(-a+O)*P+(-t+x)*u,H={x:a+J*P,y:t+J*u};return H.x>=Math.min(K.x,F.x)&&H.x<=Math.max(K.x,F.x)&&H.y>=Math.min(K.y,F.y)&&H.y<=Math.max(K.y,F.y)||(H.x=Math.abs(H.x-K.x)<Math.abs(H.x-F.x)?K.x:F.x,H.y=Math.abs(H.y-K.y)<Math.abs(H.y-F.y)?K.y:F.y),m=O-H.x,s=x-H.y,H.z=Math.sqrt(m*m+s*s),H},i=function(q,S){if(q){var Y=C(q,S).distance,F=1/0,i=null;return Y.forEach(function(Q){Q.z<F&&(F=Q.z,i=Q)}),i}},O=G.calculateLineLength,Z=G.calcSegmentIndexByDistance,b=G.calculatePointAlongLine,U=function(v,h,Q){if(!v)return Q;if(0===h){var d=v[0][0],Y=v[0][1];return Q+Math.atan2(Y.y-d.y,Y.x-d.x)}if(100===h){v=v[v.length-1];var d=v[v.length-2],Y=v[v.length-1];return Q+Math.atan2(Y.y-d.y,Y.x-d.x)}for(var N=0,w=[],E=v.length,g=0;E>g;g++){var A=v[g],q=O(A);N+=q,w.push(q)}for(var T=N*h/100,F=Z(T,w),o=0,l=0;F>l;l++)o+=w[l];T-=o;for(var $=b(v[F],T),L=v[F],H=0,t=0,C=0;C<L.length-1;C++){var _=L[C],S=L[C+1],z=S.x-_.x,I=S.y-_.y,u=Math.sqrt(z*z+I*I);if(H+=u,H>T){t=C;break}}var G=L[t];return Q+Math.atan2($.y-G.y,$.x-G.x)},$=function(K){var v=0;if(K)if(Array.isArray(K[0]))for(var j=K.length,n=0;j>n;n++){var c=K[n],H=O(c);v+=H}else v=O(K);return v},p=function(P,r,m,x){return X.set(r,m).rotateAround(null,x),P?{x:P.x+X.x,y:P.y+X.y}:{x:X.x,y:X.y}},R=function(q){var g=q._data,E=T(q);if(E){g.s("flow.reverse")&&(E.reverse(),E.forEach(function(c){c.reverse()}));for(var X=0,V=[],C=E.length,U=0;C>U;U++){var Q=E[U],c=O(Q);X+=c,V.push(c)}if(g[P]=V,g[t]=X,g[f]=E,g instanceof o.Edge){var x=J.unionPoint(E),u=x.x+x.width/2,j=x.y+x.height/2;g.$10e={x:u,y:j}}H(q,!0)}},A=G.getPercentPosition,H=function(g,T){var u=g._data,A=u[t],N=u.s(W),m=u.s(l),y=0,c=u[P],O=u.s(e),C=u.s(V),B=u.s(k),U=(O-C)/(B-1),G=[];if(c){if(1===B)G.push(O);else if(2===B)G.push(O),G.push(C);else{if(!(B>2))return;G.push(O);for(var R=B-2;R>0;R--)G.push(C+U*R);G.push(C)}var f=0,s=0;G.forEach(function(T){B-1>f&&(s+=u.getFlowElementSpace(T)),f++}),s+=(O+C)/2,y=(A-N*s+s)/N;var w=g[K];for(null==w&&(w=0),T||(w+=m);w>A+s;){var M=g._overCount;M?M++:M=1,M>=N&&(M=null),g._overCount=M,u.s("flow.autoreverse")?M?w-=y+s:(w=0,u.s("flow.reverse",!u.s("flow.reverse"))):w-=y+s}g[K]=w}},E="prototype",v=o.graph.GraphView[E],_=o.Data[E],a=m.DataUI[E],u=m.ShapeUI[E],g=m.EdgeUI[E],I=o.DataModel[E],x=o.Style;x[e]==n&&(x[e]=7),x[V]==n&&(x[V]=0),x[W]==n&&(x[W]=1),x[l]==n&&(x[l]=3),x[k]==n&&(x[k]=10),x[D]==n&&(x[D]=3.5),x[d]==n&&(x[d]=!1),x[z]==n&&(x[z]="rgba(255, 255, 114, 0.4)"),x[w]==n&&(x[w]="rgba(255, 255, 0, 0.3)"),x[s]==n&&(x[s]="rgba(255, 255, 0, 0)"),x[Q]==n&&(x[Q]=1),x[B]==n&&(x[B]=22),x[r]==n&&(x[r]=4),v.calculatePointLength=function(N,Y,m){var r=this.getDataUI(N),b=T(r);return h(b,Y,m)},J.calculatePointLength=function(v,e,N,L){var l=T(n,v,e);return h(l,N,L)},J.calculateClosestPointOnLine=F,v.calculateClosestPoint=function(M,C){var D=this.getDataUI(M),S=T(D);return i(S,C)},J.calculateClosestPoint=function(_,K,N){var t=T(n,_,K);return i(t,N)},v.getPercentAngle=function(a,e){var z=this.getDataUI(a),B=T(z);return a.getRotation?a.getRotation():0,U(B,e,a.getRotation?a.getRotation():0)},J.getPercentAngle=function(g,A,r){var f=T(n,g,A);return U(f,r,0)},v.calculateLength=function(U){var K=this.getDataUI(U),C=T(K);return $(C)},J.calculateLength=function(U,i){var w=T(n,U,i);return $(w)},v.getPercentPosition=function(t,D){var S=this.getDataUI(t),J=T(S);return A(J,D)},J.getPercentPositionOnPoints=function(p,b,h){var a=T(n,p,b);return A(a,h)};var j=function(H){var _=H.data,u=this.dm();if(_&&"add"===H.kind){var G=u.$3e;G&&_.s(L)&&G.indexOf(_)<0&&G.push(_)}"clear"===H.kind&&(u.$3e=[])},y=function(C){var q=C.property,L=C.data,F=C.newValue,D=this.dm().$3e;if(D&&"s:flow"===q)if(F)D.indexOf(L)<0&&D.push(L);else for(var $=D.length,o=0;$>o;o++)if(D[o]===L){D.splice(o,1);break}},N=v.setDataModel;v.setDataModel=function(s){var $=this,h=$._dataModel;if(h!==s){h&&(h.umm(j,$),h.umd(y,$),h.$3e=[]),s.mm(j,$),s.md(y,$);var r=s.$3e=[];s.each(function(b){b.s(L)&&r.indexOf(b)<0&&r.push(b)}),N.call($,s)}},_.getFlowElementSpace=function(){return this.s(D)};var c=function(C){var X=this,Y=X._data,l=Y[t],m=Y[P],D=Y[f],$=Y.s(W),h=0,R=X[K],G=Y.s(e),E=Y.s(V),o=Y.s(k),N=Y.s(r),g=Y.s(B),v=Y.s(d),u=(g-N)/(o-1),c=(G-E)/(o-1),O=Y.getRotation?Y.getRotation():0,S=Y.getPosition?Y.p():Y.$10e,x=[],z=[];if(R!=n){if(1===o)x.push(G);else if(2===o)x.push(G),x.push(E);else{if(!(o>2))return;x.push(G);for(var M=o-2;M>0;M--)x.push(E+c*M);x.push(E)}if(1===o)z.push(g);else if(2===o)z.push(g),z.push(N);else{if(!(o>2))return;z.push(g);for(var M=o-2;M>0;M--)z.push(N+u*M);z.push(N)}var w=0,y=0;x.forEach(function(f){o-1>w&&(y+=Y.getFlowElementSpace(f)),w++}),y+=(G+E)/2,h=(l-$*y+y)/$,C.save();for(var M=0;$>M;M++){var F=R,Q=0,j=X._overCount,q=0;Y.s("flow.autoreverse")&&j&&j>$-(M+1)||(F-=M*(h+y),w=0,x.forEach(function(E){var i=F-Q;if(i>=0&&l>i){var V=!0,P=Z(i,m);q=0;for(var G=0;P>G;G++)q+=m[G];if(i-=q,V){var t=b(D[P],i),y=O;if(v){for(var _=D[P],L=0,A=0,e=0;e<_.length-1;e++){var j=_[e],f=_[e+1],s=f.x-j.x,o=f.y-j.y,W=Math.sqrt(s*s+o*o);if(L+=W,L>i){A=e;break}}var H=_[A];y+=Math.atan2(t.y-H.y,t.x-H.x)}O&&(t=p(S,t.x-S.x,t.y-S.y,O)),X.$5e(C,t,E,z[w],y)}}Q+=Y.getFlowElementSpace(x[w]),w++}))}C.restore()}},$j=g._80o;g._80o=function(I){$j.call(this,I);var f=this,l=f._data,u=f.gv;l.s(L)&&u.$7e!=n&&c.call(f,I)};var Di=u._80o;u._80o=function(g){Di.call(this,g);var H=this,Z=H._data,J=H.gv;Z.s(L)&&J.$7e!=n&&c.call(H,g)};var wc=g._79o,uq=u._79o,Bg=function(){var x=this,Z=x._data,V=Z.s(e),q=!1,N=n;if(x._6I||(q=!0),N=Z instanceof o.Edge?wc.call(x):uq.call(x),Z.s(L)&&q){var r=Z.s(B),A=Z.s(Q);A&&r>V&&(V=r),V>0&&J.grow(N,Math.ceil(V/2)),R(x)}return!Z.s(L)&&q&&(Z[P]=Z[t]=Z[f]=x[K]=n),N};u._79o=Bg,g._79o=Bg,a.$5e=function(y,U,p,P,l){var E=this,m=E._data,N=E.gv,g=m.s(z),_=m.s(w),r=m.s(s),k=m.s(Q),L=N.$8e,C=m.s(Y);if(L==n&&(L=N.$8e={}),y.beginPath(),C!=n){var c=J.getImage(C),D=p/2;y.translate(U.x,U.y),y.rotate(l),y.translate(-U.x,-U.y),J.drawImage(y,c,U.x-D,U.y-D,p,p,m),y.translate(U.x,U.y),y.rotate(-l),y.translate(-U.x,-U.y)}else if(N.__flowBatch){var o=N.__flowBatchGroup;o||(o=N.__flowBatchGroup={});var F=[U.x,U.y,p/2];o[g]?o[g].push(F):o[g]=[F]}else y.fillStyle=g,y.arc(U.x,U.y,p/2,0,2*Math.PI,!0),y.fill();if(k){var d=22,u=d+"_"+_+"_"+r,V=L[u];if(V==n){var j=document.createElement("canvas");M.setCanvas(j,d,d);var B=j.getContext("2d"),Z=d/2,T=Z,v=Z;M.translateAndScale(B,0,0,1),B.beginPath();var e=B.createRadialGradient(T,v,0,T,T,Z);e.addColorStop(0,_),e.addColorStop(1,r),B.fillStyle=e,B.arc(T,v,Z,0,2*Math.PI,!0),B.fill(),V=L[u]=j}var D=P/2;J.drawImage(y,V,U.x-D,U.y-D,P,P,m)}},v.$9e=function(){var I=this,U=I.dm().$3e;I._24I,U.forEach(function(b){I._24I[b._id]=b}),I.iv()};var tq=I.prepareRemove;I.prepareRemove=function(K){tq.call(this,K);var $=K._dataModel,U=$.$3e;if(U)for(var n=U.length,T=0;n>T;T++)if(U[T]===K){U.splice(T,1);break}},v.setFlowInterval=function(z){var v=this,Z=v.$11e;v.$11e=z,v.fp("flowInterval",Z,z),v.$7e!=n&&(clearInterval(v.$7e),delete v.$7e,v.enableFlow(z))},v.getFlowInterval=function(){return this.$11e},v.enableFlow=function(T){var p=this,U=p.dm(),v=U.$3e;p.$7e==n&&(v.forEach(function(x){var c=p.getDataUI(x);R(c)}),p.$7e=setInterval(function(){U.$3e.forEach(function(h){H(p.getDataUI(h))}),p.$9e()},T||p.$11e||50))},v.disableFlow=function(){var v=this;clearInterval(v.$7e),delete v.$7e;var s=v.dm().$3e;s&&v.$9e()};var Rp=function(){this.__flowBatchGroup={}},oi=function(I){var G=this.__flowBatchGroup;if(G){I.save();for(var l in G){I.fillStyle=l,I.beginPath();var D=G[l];D.forEach(function(f){I.moveTo(f[0],f[1]),I.arc(f[0],f[1],f[2],0,2*Math.PI,!0)}),I.fill()}I.restore()}};v.setFlowBatch=function(o){var _=this;!!_.__flowBatch!=!!o&&(_.__flowBatch=o,o?(_.addBottomPainter(Rp),_.addTopPainter(oi)):(_.removeBottomPainter(Rp),_.removeTopPainter(oi)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
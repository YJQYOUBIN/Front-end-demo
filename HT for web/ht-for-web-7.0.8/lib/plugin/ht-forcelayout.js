!function(q,K){"use strict";var t="ht",z=t+".layout.",O=q[t]||module.parent.exports.ht,C=O.List,k=O.DataModel,l=O.Node,D=O.Edge,h=O.Group,o=Math,m=o.sqrt,n=o.random,u=o.max,v=o.min,Z=function(v){return v*v};O.Default.getInternal().addMSMap({ms_force:function(x){x._interval=50,x._stepCount=10,x._motionLimit=.01,x._edgeRepulsion=.65,x._nodeRepulsion=.65,x._damper=1,x._maxMotion=0,x._motionRatio=0,x.init=function(c){var W=this;c instanceof k?W.dm=c:W.gv=c,W._nodeMap={},W._nodes=new C,W._edges=new C},x.start=function(){var y=this,o=y.gv;if(!y._timer){var i=y.cdm=o?o.dm():y.dm;i.mm(y.handleDataModelChange,y),i.md(y.handleDataPropertyChange,y),o&&o.mp(y.handleGV,y),i.each(function(W){if(y.isVisible(W)&&y.isLayoutable(W)&&W instanceof l)if(y instanceof L){var Z=W.p3();W.p3([Z[0]+n(),Z[1]+n(),Z[2]+n()])}else Z=W.p(),W.p(Z.x+n(),Z.y+n())}),y._timer=setInterval(function(){y.relax()},y._interval),y._damper=1}},x.stop=function(){var j=this;j._timer&&(j.cdm.umm(j.handleDataModelChange,j),j.cdm.umd(j.handleDataPropertyChange,j),j.gv&&j.gv.ump(j.handleGV,j),clearInterval(j._timer),delete j._timer,delete j.cdm)},x.handleGV=function(Y){var k=this;if("dataModel"===Y.property){var c=Y.oldValue,$=Y.newValue;c&&(c.umm(k.handleDataModelChange,k),c.umd(k.handleDataPropertyChange,k)),this.cdm=$,$.mm(k.handleDataModelChange,k),$.md(k.handleDataPropertyChange,k)}},x.relax=function(){var V=this;if(!(V._damper<.1&&V._maxMotion<V._motionLimit)){this.cdm.each(function(F){V.isVisible(F)&&(F instanceof D?V.addEdge(F):F instanceof l&&V.addNode(F))});for(var g,L,R=0,x=V._edges,t=V._nodes,Z=t.size();R<V._stepCount;R++){for(x.each(V.relaxEdge,V),g=0;Z>g;g++)for(L=0;Z>L;L++)V.relaxNode(t.get(g),t.get(L));V.moveNode()}V._isAdjusting=1,t.each(function(d){d.fix||(d.p?d.v.p3(d.p):d.v.p(d.x,d.y))}),delete V._isAdjusting,V._nodeMap={},t.clear(),x.clear(),V.onRelaxed()}},x.onRelaxed=function(){},x.isRunning=function(){return!!this._timer},x.isVisible=function(z){return z.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(z):!0},x.isLayoutable=function(l){if(l.s("layoutable")===!1)return!1;if(l instanceof h)return!1;var Z=this;return Z.gv?Z.gv.isMovable(l)&&!Z.gv.isSelected(l):!(Z.cdm||Z.dm).sm().co(l)},x.getNodeRepulsion=function(){return this._nodeRepulsion},x.setNodeRepulsion=function(S){this._nodeRepulsion=S,this._damper=1},x.getEdgeRepulsion=function(){return this._edgeRepulsion},x.setEdgeRepulsion=function(P){this._edgeRepulsion=P,this._damper=1},x.getStepCount=function(){return this._stepCount},x.setStepCount=function(C){this._stepCount=C,this._damper=1},x.getInterval=function(){return this._interval},x.setInterval=function(t){var C=this;C._interval!==t&&(C._interval=t,C._timer&&(clearInterval(C._timer),C._timer=setInterval(function(){C.relax()},t)))},x.handleDataPropertyChange=function(T){!this._isAdjusting&&this.isVisible(T.data)&&(this._damper=1)},x.handleDataModelChange=function(){this._damper=1},x.damp=function(){var O=this._maxMotion,r=this._damper;this._motionRatio<=.001&&((.2>O||O>1&&.9>r)&&r>.01?this._damper-=.01:.4>O&&r>.003?this._damper-=.003:r>1e-4&&(this._damper-=1e-4)),O<this._motionLimit&&(this._damper=0)}}}),O.layout.ForceLayout=function(R){this.init(R)},O.Default.def(z+"ForceLayout",K,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(I){this._limitBounds=I,this._damper=1},getNodeSize:function(c){var u=this.gv;return u&&u.getDataUIBounds?u.getDataUIBounds(c):c.getRect()},addNode:function(V){var C=this,u=C._nodeMap[V._id];if(u)return u;var q=V.p();u={v:V,x:q.x,y:q.y,dx:0,dy:0,fix:!C.isLayoutable(V),s:C.getNodeSize(V)};var j=u.s,W=m(Z(j.width)+Z(j.height))*C._nodeRepulsion;return u.r=1>W?100:W,C._nodeMap[V._id]=u,C._nodes.add(u),u},addEdge:function(j){if(j._40I&&j._41I){var x=this,p=x.addNode(j._40I),y=x.addNode(j._41I),l={s:p,t:y};y=y.s,p=p.s;var K=y.width+p.width,C=y.height+p.height;l.length=m(K*K+C*C)*x._edgeRepulsion,l.length<=0&&(l.length=100),x._edges.add(l)}},relaxEdge:function(r){var I=r.t,T=r.s,K=I.x-T.x,O=I.y-T.y,x=m(K*K+O*O),z=100*r.length,o=.25*K/z*x,J=.25*O/z*x;I.dx=I.dx-o,I.dy=I.dy-J,T.dx=T.dx+o,T.dy=T.dy+J},relaxNode:function(H,F){if(H!==F){var b=0,C=0,O=H.x-F.x,Z=H.y-F.y,x=O*O+Z*Z;0===x?(b=n(),C=n()):36e4>x&&(b=O/x,C=Z/x);var p=H.r*F.r/400;b*=p,C*=p,H.dx+=b,H.dy+=C,F.dx-=b,F.dy-=C}},moveNode:function(){var W=this,H=W._limitBounds,E=W._maxMotion,w=0,U=W._damper;W._nodes.each(function(N){if(!N.fix){var k=N.dx*U,t=N.dy*U;if(N.dx=k/2,N.dy=t/2,w=u(m(k*k+t*t),w),N.x+=u(-40,v(40,k)),N.y+=u(-40,v(40,t)),H){N.x<H.x&&(N.x=H.x,W.adjust(1,0)),N.y<H.y&&(N.y=H.y,W.adjust(0,1));var o=N.s;N.x+o.width>H.x+H.width&&(N.x=H.x+H.width-o.width,W.adjust(-1,0)),N.y+o.height>H.y+H.height&&(N.y=H.y+H.height-o.height,W.adjust(0,-1))}}}),W._maxMotion=w,W._motionRatio=w>0?E/w-1:0,W.damp()},adjust:function(G,M){var P=this._limitBounds;this._nodes.each(function(Q){G>0?(!P||Q.x+Q.s.width+G<P.x+P.width)&&(Q.x+=G):(!P||Q.x+G>P.x)&&(Q.x+=G),M>0?(!P||Q.y+Q.s.height+M<P.y+P.height)&&(Q.y+=M):(!P||Q.y+M>P.y)&&(Q.y+=M)})}});var L=O.layout.Force3dLayout=function(r){this.init(r)};O.Default.def(z+"Force3dLayout",K,{ms_force:1,getNodeSize3d:function(Z){return Z.s3()},addNode:function(S){var _=this,n=_._nodeMap[S._id];if(n)return n;n={v:S,p:S.p3(),d:[0,0,0],fix:!_.isLayoutable(S),s:_.getNodeSize3d(S)};var M=n.s,g=O.Default.getDistance(M)*_._nodeRepulsion;return n.r=1>g?100:g,_._nodeMap[S._id]=n,_._nodes.add(n),n},addEdge:function(v){if(v._40I&&v._41I){var G=this,Q=G.addNode(v._40I),q=G.addNode(v._41I),x={s:Q,t:q};q=q.s,Q=Q.s,x.length=m(Z(q[0]+Q[0])+Z(q[1]+Q[1])+Z(q[2]+Q[2]))*G._edgeRepulsion,x.length<=0&&(x.length=100),G._edges.add(x)}},relaxEdge:function(P){var O=P.t.p,U=P.s.p,p=P.t.d,S=P.s.d,w=O[0]-U[0],H=O[1]-U[1],R=O[2]-U[2],$=m(w*w+H*H+R*R),o=100*P.length,i=.25*w/o*$,y=.25*H/o*$,J=.25*R/o*$;p[0]-=i,p[1]-=y,p[2]-=J,S[0]+=i,S[1]+=y,S[2]+=J},relaxNode:function(T,h){if(T!==h){var e=T.p,$=h.p,d=0,R=0,q=0,x=e[0]-$[0],s=e[1]-$[1],D=e[2]-$[2],K=x*x+s*s+D*D;0===K?(d=n(),R=n(),q=n()):216e6>K&&(d=x/K,R=s/K,q=D/K);var g=T.r*h.r/400,r=T.d,B=h.d;d*=g,R*=g,q*=g,r[0]+=d,r[1]+=R,r[2]+=q,B[0]-=d,B[1]-=R,B[2]-=q}},moveNode:function(){var L=this,R=L._maxMotion,X=0,t=L._damper;L._nodes.each(function(B){if(!B.fix){var s=B.p,E=B.d,W=E[0]*t,n=E[1]*t,T=E[2]*t;E[0]=W/2,E[1]=n/2,E[2]=T/2,X=u(m(W*W+n*n+T*T),X),s[0]+=u(-40,v(40,W)),s[1]+=u(-40,v(40,n)),s[2]+=u(-40,v(40,T))}}),L._maxMotion=X,L._motionRatio=X>0?R/X-1:0,L.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);